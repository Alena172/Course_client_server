{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import API from'../api';import axios from'axios';import'./UserJournal.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const UserJournal=()=>{const[entries,setEntries]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const navigate=useNavigate();useEffect(()=>{const fetchJournal=async()=>{try{const userId=localStorage.getItem('userId');if(!userId){throw new Error('Требуется авторизация');}const response=await API.get(`api/news/${userId}/journal`);// Добавляем проверку на массив\nconst receivedData=Array.isArray(response.data)?response.data:[];setEntries(receivedData.map(entry=>({...entry,title:entry.title||'Без названия',description:entry.description||'Описание отсутствует',source:entry.source||'unknown',publishedAt:entry.publishedAt||entry.createdAt,imageUrl:entry.imageUrl||'/placeholder-news.jpg'})));}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||err.message||'Ошибка загрузки журнала');console.error('Ошибка:',err);}finally{setLoading(false);}};fetchJournal();},[]);const handleRemove=async entryId=>{if(!window.confirm('Удалить эту новость из журнала?'))return;try{setLoading(true);const response=await API.delete(`api/news/journal/${entryId}`);setEntries(prev=>prev.filter(e=>e._id!==entryId));console.log('Delete successful:',response.data);}catch(err){var _err$response2,_err$response3,_err$response3$data;console.error('Delete failed:',{error:err,response:(_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.data});alert(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.message)||'Не удалось удалить новость');try{const{data}=await API.get(`api/news/${localStorage.getItem('userId')}/journal`);setEntries(data);}catch(fetchErr){console.error('Failed to refresh:',fetchErr);}}finally{setLoading(false);}};const handleGoToHome=()=>{navigate('/');};if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"});if(error)return/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:error});return/*#__PURE__*/_jsxs(\"div\",{className:\"journal-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"journal-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0412\\u0430\\u0448 \\u0436\\u0443\\u0440\\u043D\\u0430\\u043B \\u043D\\u043E\\u0432\\u043E\\u0441\\u0442\\u0435\\u0439\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleGoToHome,className:\"home-button\",children:\"\\u041D\\u0430 \\u0433\\u043B\\u0430\\u0432\\u043D\\u0443\\u044E\"})]}),entries.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"empty\",children:\"\\u041D\\u0435\\u0442 \\u0441\\u043E\\u0445\\u0440\\u0430\\u043D\\u0435\\u043D\\u043D\\u044B\\u0445 \\u043D\\u043E\\u0432\\u043E\\u0441\\u0442\\u0435\\u0439\"}):/*#__PURE__*/_jsx(\"div\",{className:\"entries\",children:entries.map(entry=>/*#__PURE__*/_jsxs(\"div\",{className:\"entry\",children:[entry.imageUrl&&/*#__PURE__*/_jsx(\"div\",{className:\"image-wrapper\",children:/*#__PURE__*/_jsx(\"img\",{src:entry.imageUrl,alt:entry.title,onError:e=>{e.target.src='/placeholder-news.jpg';e.target.onerror=null;}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:entry.title}),/*#__PURE__*/_jsx(\"span\",{className:\"source\",children:entry.source})]}),/*#__PURE__*/_jsx(\"p\",{className:\"description\",children:entry.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"footer\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"date\",children:new Date(entry.publishedAt).toLocaleDateString('ru-RU',{day:'numeric',month:'long',year:'numeric'})}),/*#__PURE__*/_jsxs(\"div\",{className:\"actions\",children:[/*#__PURE__*/_jsx(\"a\",{href:entry.url,target:\"_blank\",rel:\"noopener noreferrer\",className:\"link\",children:\"\\u0427\\u0438\\u0442\\u0430\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleRemove(entry._id),className:\"delete-btn\",children:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"})]})]})]})]},entry._id))})]});};export default UserJournal;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","API","axios","jsx","_jsx","jsxs","_jsxs","UserJournal","entries","setEntries","loading","setLoading","error","setError","navigate","fetchJournal","userId","localStorage","getItem","Error","response","get","receivedData","Array","isArray","data","map","entry","title","description","source","publishedAt","createdAt","imageUrl","err","_err$response","_err$response$data","message","console","handleRemove","entryId","window","confirm","delete","prev","filter","e","_id","log","_err$response2","_err$response3","_err$response3$data","alert","fetchErr","handleGoToHome","className","children","onClick","length","src","alt","onError","target","onerror","Date","toLocaleDateString","day","month","year","href","url","rel"],"sources":["D:/Study/Course_rksp/frontend/src/components/UserJournal.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport API from '../api';\r\nimport axios from 'axios';\r\nimport './UserJournal.css';\r\n\r\nconst UserJournal = () => {\r\n  const [entries, setEntries] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    const fetchJournal = async () => {\r\n      try {\r\n        const userId = localStorage.getItem('userId');\r\n        if (!userId) {\r\n          throw new Error('Требуется авторизация');\r\n        }\r\n\r\n        const response = await API.get(`api/news/${userId}/journal`);\r\n        \r\n        // Добавляем проверку на массив\r\n        const receivedData = Array.isArray(response.data) ? response.data : [];\r\n        \r\n        setEntries(receivedData.map(entry => ({\r\n          ...entry,\r\n          title: entry.title || 'Без названия',\r\n          description: entry.description || 'Описание отсутствует',\r\n          source: entry.source || 'unknown',\r\n          publishedAt: entry.publishedAt || entry.createdAt,\r\n          imageUrl: entry.imageUrl || '/placeholder-news.jpg'\r\n        })));\r\n      } catch (err) {\r\n        setError(err.response?.data?.message || err.message || 'Ошибка загрузки журнала');\r\n        console.error('Ошибка:', err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchJournal();\r\n  }, []);\r\n  \r\n  const handleRemove = async (entryId) => {\r\n    if (!window.confirm('Удалить эту новость из журнала?')) return;\r\n  \r\n    try {\r\n      setLoading(true);\r\n      const response = await API.delete(`api/news/journal/${entryId}`);\r\n      setEntries(prev => prev.filter(e => e._id !== entryId));\r\n      console.log('Delete successful:', response.data);\r\n    } catch (err) {\r\n      console.error('Delete failed:', {\r\n        error: err,\r\n        response: err.response?.data\r\n      });\r\n      alert(err.response?.data?.message || 'Не удалось удалить новость');\r\n      try {\r\n        const { data } = await API.get(`api/news/${localStorage.getItem('userId')}/journal`);\r\n        setEntries(data);\r\n      } catch (fetchErr) {\r\n        console.error('Failed to refresh:', fetchErr);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleGoToHome = () => {\r\n    navigate('/');\r\n  };\r\n\r\n  if (loading) return <div className=\"loading\">Загрузка...</div>;\r\n  if (error) return <div className=\"error\">{error}</div>;\r\n\r\n  return (\r\n    <div className=\"journal-container\">\r\n      <div className=\"journal-header\">\r\n        <h2>Ваш журнал новостей</h2>\r\n        <button \r\n          onClick={handleGoToHome}\r\n          className=\"home-button\"\r\n        >\r\n          На главную\r\n        </button>\r\n      </div>\r\n      \r\n      {entries.length === 0 ? (\r\n        <p className=\"empty\">Нет сохраненных новостей</p>\r\n      ) : (\r\n        <div className=\"entries\">\r\n          {entries.map(entry => (\r\n            <div key={entry._id} className=\"entry\">\r\n              {entry.imageUrl && (\r\n                <div className=\"image-wrapper\">\r\n                  <img \r\n                    src={entry.imageUrl} \r\n                    alt={entry.title}\r\n                    onError={(e) => {\r\n                      e.target.src = '/placeholder-news.jpg';\r\n                      e.target.onerror = null;\r\n                    }}\r\n                  />\r\n                </div>\r\n              )}\r\n              \r\n              <div className=\"content\">\r\n                <div className=\"header\">\r\n                  <h3>{entry.title}</h3>\r\n                  <span className=\"source\">{entry.source}</span>\r\n                </div>\r\n                \r\n                <p className=\"description\">{entry.description}</p>\r\n                \r\n                <div className=\"footer\">\r\n                  <span className=\"date\">\r\n                    {new Date(entry.publishedAt).toLocaleDateString('ru-RU', {\r\n                      day: 'numeric',\r\n                      month: 'long',\r\n                      year: 'numeric'\r\n                    })}\r\n                  </span>\r\n                  \r\n                  <div className=\"actions\">\r\n                    <a \r\n                      href={entry.url} \r\n                      target=\"_blank\" \r\n                      rel=\"noopener noreferrer\"\r\n                      className=\"link\"\r\n                    >\r\n                      Читать\r\n                    </a>\r\n                    <button \r\n                      onClick={() => handleRemove(entry._id)}\r\n                      className=\"delete-btn\"\r\n                    >\r\n                      Удалить\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UserJournal;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}